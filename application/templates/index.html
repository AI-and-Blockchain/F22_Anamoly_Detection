<!doctype html>
<html lang="en">
<head>
	<title>CAT Web App</title>
	<!-- CSS only -->
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
	<!-- JavaScript Bundle with Popper -->
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
</head>

<body>
	{% if warning is defined %}
		<div class="alert alert-warning" role="alert">
			{{ warning }}
		</div>
	{% endif %}

	{% if classification is defined %}
		{% if classification == "Legitimate" %}
			<div class="alert alert-success" role="alert">
				{{ address }} seems to be a {{ classification }} address.
			</div>
		{% else %}
			<div class="alert alert-danger" role="alert">
				{{ address }} seems to be an {{ classification }} address.
			</div>
		{% endif %}
	{% endif %}
	<!-- <form name="addressInput" method="post" action="javascript:validateForm()"> -->
	<form name="addressInput" method="post" action="{{ url_for('get_features') }}">
		<div class="mb-3">
			<label for="address" class="form-label">Ethereum Address to be classified</label>
			<input type="text" name="address" class="form-control" id="addressInput" aria-describedby="addressHelp">
			<div id="addressHelp" class="form-text">Make sure Ethereum Address is a properly formatted hexadecimal value</div>
		</div>
		<button type="submit" class="btn btn-primary">Classify</button>
	</form>
</body>

</html>

<script type="text/javascript">
	// Get form input
	function validateForm() {
		let addr = document.forms["addressInput"]["address"].value;
		if (!/^(0x)?[0-9a-f]{40}$/){
			console.log("ERROR");
			var message = "WARNING: ".concat(addr, " is not valid!");
			var wrapper = document.createElement("div");
			wrapper.innerHTML = '<div class="alert alert-info" role="alert" id="dynamicWarning">'+message+'</div>'
			document.body.appendChild(wrapper);
		} else {
			console.log("It's an address!");
			var elem = document.getElementById("dynamicWarning");
			if (elem){
				elem.remove();
			}

			var xhr = new XMLHttpRequest();
			xhr.open('POST', '/get_features/'.concat(addr), true);
			xhr.onreadystatechange = function(){
                if(xhr.readyState == XMLHttpRequest.DONE){
                	result = JSON.parse(xhr.responseText);
                	console.log(result);
                    // document.getElementById('prediction').innerHTML="Prediction: EUR "+xhr.responseText
                    // document.getElementById('model').innerHTML="Model: Random Forest Regression"
                    // document.getElementById('RMSE').innerHTML="RMSE: "+xhr.responseText;
                };
            
            };
		}
	}
</script>